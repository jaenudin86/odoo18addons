<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="product_qrcode_label_template">
        <t t-call="web.basic_layout">
            <div class="page" style="padding: 0;">
                <style>
                    body {
                        margin-top: 5mm !important;
                    }
                    .page {
                        padding: 0;
                        margin: 0;
                        margin-top: -5mm;
                    }
                    .label-row {
                        display: table;
                        width: 100%;
                        table-layout: fixed;
                        page-break-inside: avoid;
                    }
                    .qrcode_container {
                        display: table-cell;
                        width: 33.33%;
                        padding: 5px 3px;
                        box-sizing: border-box;
                        text-align: center;
                        overflow: hidden;
                        height: 140px;
                        font-size: 13px;
                        line-height: 1.1;
                        vertical-align: top;
                    }
                    .qrcode_img {
                        width: 85px;
                        height: 85px;
                        display: block;
                        margin: 2px auto;
                    }
                    .internal_ref {
                        height: 40px;
                        display: block;
                        margin-top: 10px;
                        font-size: 13px;
                    }
                    .page-break {
                        page-break-after: always;
                        display: block;
                        clear: both;
                    }
                </style>

                <!-- Loop per baris (3 label per baris, 6 baris per halaman = 18 label) -->
                <t t-set="items_per_row" t-value="3"/>
                <t t-set="rows_per_page" t-value="6"/>
                <t t-set="total" t-value="len(label_data)"/>
                <t t-set="row_index" t-value="0"/>

                <t t-foreach="range(0, total, items_per_row)" t-as="row_start">
                    <div class="label-row">
                        <t t-foreach="label_data[row_start:row_start + items_per_row]" t-as="label">
                            <div class="qrcode_container">
                                <span class="internal_ref">
                                    <t t-esc="label['name']"/>
                                    <br/>
                                    <t t-esc="label['variant']"/>
                                    <br/>
                                    <t t-esc="label['barcode']"/>
                                </span>
                                <img t-if="label['barcode']"
                                     t-att-src="'/report/barcode/QR/%s' % label['barcode']"
                                     class="qrcode_img"
                                     alt="QR Code"/>
                                <div t-else="" style="width: 85px; height: 85px; margin: 2px auto; border: 1px dashed #ccc; display: table-cell; text-align: center; vertical-align: middle; font-size: 10px; color: #999;">
                                    No Barcode
                                </div>
                            </div>
                        </t>
                    </div>

                    <!-- Page break setiap 6 baris (18 label) -->
                    <t t-set="row_index" t-value="row_index + 1"/>
                    <t t-if="row_index % rows_per_page == 0 and (row_start + items_per_row) &lt; total">
                        <p class="page-break"/>
                    </t>
                </t>

            </div>
        </t>
    </template>
</odoo>