<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Paper Format A4 -->
    <record id="paperformat_qrcode_label_a4" model="report.paperformat">
        <field name="name">A4 Minimal Margin Label</field>
        <field name="format">A4</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">10</field>
        <field name="margin_bottom">6</field>
        <field name="margin_left">3</field>
        <field name="margin_right">3</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">3</field>
        <field name="dpi">90</field>
    </record>

    <!-- ========================================== -->
    <!-- PRODUCT QR CODE REPORT - A4 FORMAT -->
    <!-- ========================================== -->
    
    <!-- Report Action for Product -->
    <record id="action_report_product_qrcode" model="ir.actions.report">
        <field name="name">Product QR Code - All Serial Numbers</field>
        <field name="model">product.product</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">brodher_product_serial.product_qrcode_report</field>
        <field name="report_file">brodher_product_serial.product_qrcode_report</field>
        <field name="paperformat_id" ref="paperformat_qrcode_label_a4"/>
        <field name="binding_model_id" ref="product.model_product_product"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Report Template for Product -->
    <template id="product_qrcode_report">
        <t t-call="web.basic_layout">
            <div class="page" style="padding: 0;">
                <style>
                    body {
                        margin-top: 5mm !important;
                    }
                    .page {
                        padding: 0;
                        margin: 0;
                        margin-top: -10mm;
                    }
                    .qrcode_container {
                        width: 33.33%;
                        float: left;
                        padding: 5px 3px;
                        box-sizing: border-box;
                        text-align: center;
                        overflow: hidden;
                        height: 180px;
                        font-size: 10px;
                        line-height: 1.2;
                    }
                    .qrcode_img {
                        width: 120px;
                        height: 120px;
                        display: block;
                        margin: 5px auto;
                    }
                    .sn_code {
                        display: block;
                        font-weight: bold;
                        font-size: 14px;
                        margin-top: 5px;
                    }
                </style>

                <t t-foreach="docs" t-as="product">
                    <!-- Get all serial numbers for this product -->
                    <t t-set="serial_numbers" t-value="product.env['stock.lot'].search([('product_id', '=', product.id), ('sn_type', '!=', False)], order='name')"/>

                    <div style="display: flex; flex-wrap: wrap;">
                        <t t-foreach="serial_numbers" t-as="sn">
                            <div class="qrcode_container">
                                <!-- QR Code -->
                                <img t-att-src="'/report/barcode/QR/%s' % sn.name" 
                                     class="qrcode_img"/>

                                <!-- Serial Number -->
                                <span class="sn_code">
                                    <t t-esc="sn.name"/>
                                </span>
                            </div>
                        </t>
                    </div>
                </t>
            </div>
        </t>
    </template>

    <!-- ========================================== -->
    <!-- PRODUCT TEMPLATE QR CODE REPORT - A4 FORMAT -->
    <!-- ========================================== -->
    
    <!-- Report Action for Product Template -->
    <record id="action_report_product_template_qrcode" model="ir.actions.report">
        <field name="name">Product QR Code - All Variants</field>
        <field name="model">product.template</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">brodher_product_serial.product_template_qrcode_report</field>
        <field name="report_file">brodher_product_serial.product_template_qrcode_report</field>
        <field name="paperformat_id" ref="paperformat_qrcode_label_a4"/>
        <field name="binding_model_id" ref="product.model_product_template"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Report Template for Product Template -->
    <template id="product_template_qrcode_report">
        <t t-call="web.basic_layout">
            <div class="page" style="padding: 0;">
                <style>
                    body {
                        margin-top: 5mm !important;
                    }
                    .page {
                        padding: 0;
                        margin: 0;
                        margin-top: -10mm;
                    }
                    .qrcode_container {
                        width: 33.33%;
                        float: left;
                        padding: 5px 3px;
                        box-sizing: border-box;
                        text-align: center;
                        overflow: hidden;
                        height: 180px;
                        font-size: 10px;
                        line-height: 1.2;
                    }
                    .qrcode_img {
                        width: 120px;
                        height: 120px;
                        display: block;
                        margin: 5px auto;
                    }
                    .sn_code {
                        display: block;
                        font-weight: bold;
                        font-size: 14px;
                        margin-top: 5px;
                    }
                </style>

                <t t-foreach="docs" t-as="product_tmpl">
                    <!-- Loop through all variants -->
                    <t t-foreach="product_tmpl.product_variant_ids" t-as="variant">
                        <!-- Get all serial numbers for this variant -->
                        <t t-set="serial_numbers" t-value="variant.env['stock.lot'].search([('product_id', '=', variant.id), ('sn_type', '!=', False)], order='name')"/>

                        <div style="display: flex; flex-wrap: wrap;">
                            <t t-foreach="serial_numbers" t-as="sn">
                                <div class="qrcode_container">
                                    <!-- QR Code -->
                                    <img t-att-src="'/report/barcode/QR/%s' % sn.name" 
                                         class="qrcode_img"/>

                                    <!-- Serial Number -->
                                    <span class="sn_code">
                                        <t t-esc="sn.name"/>
                                    </span>
                                </div>
                            </t>
                        </div>
                    </t>
                </t>
            </div>
        </t>
    </template>

    <!-- ========================================== -->
    <!-- STOCK PICKING QR CODE REPORT - A4 FORMAT -->
    <!-- ========================================== -->
    
    <!-- Report Action for Stock Picking -->
    <record id="action_report_stock_picking_qrcode" model="ir.actions.report">
        <field name="name">Stock Picking QR Code</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">brodher_product_serial.stock_picking_qrcode_report</field>
        <field name="report_file">brodher_product_serial.stock_picking_qrcode_report</field>
        <field name="paperformat_id" ref="paperformat_qrcode_label_a4"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_type">report</field>
    </record>


    <!-- Report Template for Stock Picking -->
    <template id="stock_picking_qrcode_report">
        <t t-call="web.basic_layout">
            <div class="page" style="padding: 0;">
                <style>
                    body {
                        margin-top: 5mm !important;
                    }
                    .page {
                        padding: 0;
                        margin: 0;
                        margin-top: -10mm;
                    }
                    .qrcode_container {
                        width: 33.33%;
                        float: left;
                        padding: 5px 3px;
                        box-sizing: border-box;
                        text-align: center;
                        overflow: hidden;
                        height: 180px;
                        font-size: 10px;
                        line-height: 1.2;
                    }
                    .qrcode_img {
                        width: 120px;
                        height: 120px;
                        display: block;
                        margin: 5px auto;
                    }
                    .sn_code {
                        display: block;
                        font-weight: bold;
                        font-size: 14px;
                        margin-top: 5px;
                    }
                </style>

                <t t-foreach="docs" t-as="picking">
                    <div style="display: flex; flex-wrap: wrap;">
                        <t t-foreach="picking.sn_move_ids" t-as="sn_move">
                            <t t-set="sn" t-value="sn_move.serial_number_id"/>
                            <div class="qrcode_container">
                                <!-- QR Code -->
                                <img t-att-src="'/report/barcode/QR/%s' % sn.name" 
                                     class="qrcode_img"/>

                                <!-- Serial Number -->
                                <span class="sn_code">
                                    <t t-esc="sn.name"/>
                                </span>
                            </div>
                        </t>
                    </div>
                </t>
            </div>
        </t>
    </template>

</odoo>