<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ========================= -->
    <!-- PRODUCT TEMPLATE FORM -->
    <!-- ========================= -->
    <record id="view_product_template_form_article" model="ir.ui.view">
        <field name="name">product.template.form.article</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">

            <!-- HIDE PRODUCT TYPE -->
            <xpath expr="//field[@name='type']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='barcode']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <!-- Update Quantity -->
            <xpath expr="//button[@name='action_update_quantity_on_hand']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <!-- ======================================= -->
            <!-- HIDE SEMUA DI PRODUCT TEMPLATE:        -->
            <!-- Price, Pajak, Cost, Unit               -->
            <!-- Semua dikelola di variant              -->
            <!-- ======================================= -->
            <xpath expr="//field[@name='list_price']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='currency_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='taxes_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='supplier_taxes_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='standard_price']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='uom_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='uom_po_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='type']" position="before">
                <field name="is_article" widget="radio"/>

                <!-- PSIT -->
                <field name="brand" required="true"/>

                <!-- <field name="dimension"
                       invisible="is_article != 'no'"
                       required="is_article == 'no'"/> -->

                <field name="base_colour"
                       invisible="is_article != 'no'"/>

                <field name="text_colour"
                       invisible="is_article != 'no'"/>

                <!-- ATC -->
                <field name="date_month_year"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>
                <field name="ingredients"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>
                <field name="Edition"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>

            </xpath>

            <!-- Hapus default_code dari posisi aslinya -->
            <xpath expr="//field[@name='default_code']" position="replace"/>

            <!-- Tambahkan default_code di bawah brand -->
            <xpath expr="//field[@name='brand']" position="after">
                <field name="default_code"
                       string="PSIT Number"
                       invisible="is_article != 'no'"
                       readonly="1"
                       force_save="1"/>
                <field name="default_code"
                       string="ATC Number"
                       invisible="is_article != 'yes'"
                       readonly="1"
                       force_save="1"/>
            </xpath>

        </field>
    </record>

    <!-- ========================= -->
    <!-- PRODUCT TEMPLATE TREE -->
    <!-- ========================= -->
    <record id="view_product_template_tree_article" model="ir.ui.view">
        <field name="name">product.template.tree.article</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='name']" position="after">
                <field name="is_article"/>
                <field name="brand"/>
                <field name="default_code" string="Internal Reference"/>
            </xpath>

        </field>
    </record>

    <!-- ========================= -->
    <!-- PRODUCT VARIANT FORM -->
    <!-- ========================= -->
    <record id="view_product_variant_form_article" model="ir.ui.view">
        <field name="name">product.product.form.article</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_normal_form_view"/>
        <field name="arch" type="xml">

            <!-- HIDE TYPE -->
            <xpath expr="//field[@name='type']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <!-- Update Quantity -->
            <xpath expr="//button[@name='action_update_quantity_on_hand']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <!-- ======================================= -->
            <!-- TAMPILKAN SEMUA DI VARIANT:            -->
            <!-- Sales Price, Pajak, Cost, Unit         -->
            <!-- ======================================= -->
            <xpath expr="//field[@name='lst_price']" position="attributes">
                <attribute name="invisible">0</attribute>
                <attribute name="readonly">0</attribute>
                <attribute name="string">Sales Price</attribute>
            </xpath>
            <xpath expr="//field[@name='taxes_id']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>
            <xpath expr="//field[@name='supplier_taxes_id']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>
            <xpath expr="//field[@name='standard_price']" position="attributes">
                <attribute name="invisible">0</attribute>
                <attribute name="readonly">0</attribute>
            </xpath>
            <xpath expr="//field[@name='uom_id']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>
            <xpath expr="//field[@name='uom_po_id']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>

            <!--
                PENTING: is_article harus PERTAMA kali ditampilkan
                supaya kondisi invisible field lain bisa terbaca saat form di-render.
            -->
            <xpath expr="//field[@name='type']" position="after">

                <!-- Tampilkan is_article DULU - ini yang jadi acuan invisible -->
                <field name="is_article" widget="radio" readonly="1"/>

                <!-- PSIT fields -->
                <field name="brand"
                       invisible="is_article != 'no'"
                       required="is_article == 'no'"/>

                <field name="dimension"
                       invisible="is_article != 'no'"
                       required="is_article == 'no'"/>

                <field name="base_colour"
                       invisible="is_article != 'no'"/>

                <field name="text_colour"
                       invisible="is_article != 'no'"/>

                <!-- ATC fields -->
                <field name="date_month_year"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>

                <field name="ingredients"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>

                <field name="Edition"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>

                <field name="gross_weight"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>

                <field name="net_weight"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>

                <field name="net_net_weight"
                       invisible="is_article != 'yes'"
                       required="is_article == 'yes'"/>

            </xpath>

            <!-- DEFAULT CODE di variant - readonly karena auto-generate -->
            <xpath expr="//field[@name='default_code']" position="replace">
                <field name="default_code"
                       string="PSIT Number"
                       invisible="is_article != 'no'"
                       readonly="1"/>

                <field name="default_code"
                       string="ATC Number"
                       invisible="is_article != 'yes'"
                       readonly="1"/>
            </xpath>

        </field>
    </record>

    <!-- ========================= -->
    <!-- SEQUENCES -->
    <!-- ========================= -->

    <record id="seq_article_number" model="ir.sequence">
        <field name="name">Article Number</field>
        <field name="code">article.number.sequence</field>
        <field name="prefix">ATC%(day)s%(month)s%(year)s</field>
        <field name="padding">3</field>
        <field name="implementation">standard</field>
        <field name="use_date_range">True</field>
    </record>

    <record id="seq_psit_number" model="ir.sequence">
        <field name="name">PSIT Number</field>
        <field name="code">pist.number.sequence</field>
        <field name="prefix">PSIT%(year)s</field>
        <field name="padding">4</field>
        <field name="implementation">standard</field>
        <field name="use_date_range">True</field>
    </record>

</odoo>